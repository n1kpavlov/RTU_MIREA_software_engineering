@startuml test
actor Покупатель
participant "Интерфейс пользователя" as UI
participant "Система управления билетами" as TicketSystem
participant "База данных" as Database
participant "Платежный шлюз" as PaymentGateway

Покупатель -> UI: 1. Запрос на просмотр спектаклей
UI -> TicketSystem: 2. Запрос списка спектаклей
TicketSystem -> Database: 3. Получить список спектаклей
Database --> TicketSystem: 4. Возвращает список спектаклей
TicketSystem --> UI: 5. Передает данные о спектаклях
UI --> Покупатель: 6. Отображает список спектаклей

Покупатель -> UI: 7. Выбирает спектакль и запрашивает места
UI -> TicketSystem: 8. Запрос свободных мест
TicketSystem -> Database: 9. Проверить доступность мест
Database --> TicketSystem: 10. Возвращает список свободных мест
TicketSystem --> UI: 11. Передает данные о местах
UI --> Покупатель: 12. Отображает схему зала

Покупатель -> UI: 13. Выбирает место и подтверждает
UI -> TicketSystem: 14. Запрос на бронирование места
TicketSystem -> Database: 15. Заблокировать место
Database --> TicketSystem: 16. Подтверждает блокировку
TicketSystem --> UI: 17. Уведомление об успешном бронировании
UI --> Покупатель: 18. Запрос ввода платежных данных

Покупатель -> UI: 19. Вводит данные карты и подтверждает оплату
UI -> PaymentGateway: 20. Отправка данных для оплаты
PaymentGateway --> UI: 21. Подтверждение успешной оплаты
UI -> TicketSystem: 22. Уведомление об оплате
TicketSystem -> Database: 23. Подтвердить бронь и отметить место как проданное
Database --> TicketSystem: 24. Подтверждает обновление статуса
TicketSystem --> UI: 25. Передает электронный билет
UI --> Покупатель: 26. Отображает билет и отправляет на email
@enduml