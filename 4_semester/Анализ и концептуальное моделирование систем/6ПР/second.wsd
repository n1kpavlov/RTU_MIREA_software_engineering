@startuml second
scale 800 width
skinparam activity {
  BackgroundColor White
  BorderColor #333333
  FontName Arial
  FontSize 12
  FontStyle bold
}

skinparam note {
  BackgroundColor #f9f9f9
  BorderColor #cccccc
  FontName Arial
  FontSize 10
}

title Диаграмма деятельности процесса продажи билетов **с дорожками**

|#lightgray|**Покупатель**|
|#lightblue|**Система бронирования**|
|#lightgreen|**Платежная система**|

|**Покупатель**|
start
:Выбрать спектакль;

|**Система бронирования**|
:Проверить доступность мест;
if (Места есть?) then (Да)
  :Добавить в корзину;
  :Запустить таймер (10 мин);
  |**Покупатель**|
  :Подтвердить данные;
  |**Система бронирования**|
  if (Данные верны?) then (Да)
    :Забронировать место;
    |**Платежная система**|
    repeat
      :Инициировать оплату;
      if (Оплата успешна?) then (Да)
        :Подтвердить транзакцию;
        |**Система бронирования**|
        :Отправить билет;
        |**Покупатель**|
        :Получить билет;
        stop
      else (Нет)
        :Получить уведомление;
        |**Система бронирования**|
      endif
    repeat while (Попытки < 3?) is (Да)
    ->Нет;
    |**Система бронирования**|
    :Отменить бронь;
    :Освободить место;
    stop
  else (Нет)
    :Освободить место;
    stop
  endif
else (Нет)
  |**Покупатель**|
  :Получить уведомление;
  stop
endif

@enduml