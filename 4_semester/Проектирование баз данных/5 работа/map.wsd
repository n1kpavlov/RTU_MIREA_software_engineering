@startuml Логическая модель данных велосервиса

' Настройки отображения
hide circle
skinparam linetype ortho
skinparam packageStyle rectangle
left to right direction

' #######################
' ### Нормативно-справочные сущности
' #######################

entity "Статусы" {
  * Код_статуса : INTEGER <<PK>>
  --
  * Название : VARCHAR(50)
  Описание : TEXT
}

entity "Типы_неисправностей" {
  * Код_неисправности : INTEGER <<PK>>
  --
  * Название : VARCHAR(100)
  Критичность : SMALLINT
  Описание : TEXT
}

entity "Запчасти" {
  * Код_запчасти : INTEGER <<PK>>
  --
  * Наименование : VARCHAR(100)
  * Цена : DECIMAL(10,2)
  Количество_на_складе : INTEGER
  Минимальный_запас : INTEGER
  Характеристики : JSON
}

entity "Виды_работ" {
  * Код_работы : INTEGER <<PK>>
  --
  * Наименование : VARCHAR(100)
  * Стоимость : DECIMAL(10,2)
  * Норма_времени : INTERVAL
  Требуемые_запчасти : JSON
}

' #######################
' ### Основные сущности
' #######################

entity "Клиенты" {
  * Код_клиента : INTEGER <<PK>>
  --
  * ФИО : VARCHAR(100)
  * Телефон : VARCHAR(20)
  Email : VARCHAR(100)
  Дата_регистрации : DATE
}

entity "Велосипеды" {
  * Код_велосипеда : INTEGER <<PK>>
  --
  * Код_клиента : INTEGER <<FK>>
  * Марка : VARCHAR(50)
  * Модель : VARCHAR(50)
  Год_выпуска : SMALLINT
  VIN : VARCHAR(50)
}

entity "Сотрудники" {
  * Код_сотрудника : INTEGER <<PK>>
  --
  * ФИО : VARCHAR(100)
  * Должность : VARCHAR(50)
  Специализация : VARCHAR(100)
  * Дата_приема : DATE
}

entity "Заявки" {
  * Код_заявки : INTEGER <<PK>>
  --
  * Код_клиента : INTEGER <<FK>>
  * Код_велосипеда : INTEGER <<FK>>
  * Код_менеджера : INTEGER <<FK>>
  * Дата_заявки : TIMESTAMP
  * Описание_проблемы : TEXT
  * Код_статуса : INTEGER <<FK>>
}

entity "Заказы" {
  * Код_заказа : INTEGER <<PK>>
  --
  * Код_заявки : INTEGER <<FK>>
  * Код_менеджера : INTEGER <<FK>>
  * Код_механика : INTEGER <<FK>>
  Дата_начала : TIMESTAMP
  Дата_окончания : TIMESTAMP
  * Код_статуса : INTEGER <<FK>>
}

entity "Сметы" {
  * Код_сметы : INTEGER <<PK>>
  --
  * Код_заказа : INTEGER <<FK>>
  * Стоимость_работ : DECIMAL(10,2)
  * Стоимость_запчастей : DECIMAL(10,2)
  * Итоговая_сумма : DECIMAL(10,2)
  * Подтверждено : BOOLEAN
  Дата_подтверждения : TIMESTAMP
}

entity "Акты_выполненных_работ" {
  * Код_акта : INTEGER <<PK>>
  --
  * Код_заказа : INTEGER <<FK>>
  * Код_механика : INTEGER <<FK>>
  * Дата_проверки : TIMESTAMP
  * Результат : VARCHAR(20)
  Примечания : TEXT
}

' #######################
' ### Связи между сущностями
' #######################

Клиенты "1" }-- "n" Велосипеды : "Владеет"
Клиенты "1" }-- "n" Заявки : "Оставляет"

Велосипеды "1" }-- "n" Заявки : "Обслуживается"

Заявки "1" }-- "1" Сотрудники : "Принимает менеджер"
Заявки "n" }-- "1" Статусы : "Имеет статус"
Заявки "n" }-- "m" Типы_неисправностей : "Классифицируется по"

Заказы "1" }-- "1" Заявки : "Формируется на основании"
Заказы "n" }-- "1" Сотрудники : "Выполняет механик"
Заказы "n" }-- "1" Статусы : "Имеет статус"
Заказы "1" }-- "1" Сметы : "Содержит"
Заказы "1" }-- "1" Акты_выполненных_работ : "Подтверждается"

Заказы "n" }-- "m" Виды_работ : "Включает работы"
Заказы "n" }-- "m" Запчасти : "Использует запчасти"

Акты_выполненных_работ "n" }-- "1" Сотрудники : "Подписывает механик"

@enduml